<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Trabajando con la ENOE y Python | Adrian Vázquez E. </title> <meta name="author" content="Adrian Vázquez E."> <meta name="description" content="Descarga y configura los datos de la Encuesta Nacional de Ocupación y Empleo para realizar análisis estadísticos"> <link rel="stylesheet" href="/thisportfolio.github.io/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/thisportfolio.github.io/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/thisportfolio.github.io/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%92%BC&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/thisportfolio.github.io/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://adrianv443.github.io/thisportfolio.github.io/projects/1_project/"> <script src="/thisportfolio.github.io/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/thisportfolio.github.io/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/thisportfolio.github.io/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/thisportfolio.github.io/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/thisportfolio.github.io/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/thisportfolio.github.io/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/thisportfolio.github.io/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/thisportfolio.github.io/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script src="/thisportfolio.github.io/assets/js/distillpub/template.v2.js"></script> <script src="/thisportfolio.github.io/assets/js/distillpub/transforms.v2.js"></script> <script src="/thisportfolio.github.io/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Trabajando con la ENOE y Python",
            "description": "Descarga y configura los datos de la Encuesta Nacional de Ocupación y Empleo para realizar análisis estadísticos",
            "published": "January 20, 2025",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/thisportfolio.github.io/"> <span class="font-weight-bold">Adrian</span> Vázquez E. </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/thisportfolio.github.io/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/thisportfolio.github.io/blog/">Blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/thisportfolio.github.io/projects/">Proyectos <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/thisportfolio.github.io/cv/">CV 📝 </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Trabajando con la ENOE y Python</h1> <p>Descarga y configura los datos de la Encuesta Nacional de Ocupación y Empleo para realizar análisis estadísticos</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contenido</h3> <div> <a href="#flujo-de-trabajo">Flujo de trabajo</a> </div> <div> <a href="#entendiendo-las-tablas-y-sus-relaciones">Entendiendo las tablas y sus relaciones</a> </div> <ul> <li> <a href="#factor-de-expansi%C3%B3n">Factor de expansión</a> </li> <li> <a href="#dise%C3%B1o-de-modelo-multidimensional">Diseño de modelo multidimensional</a> </li> </ul> <div> <a href="#descarga-de-datos">Descarga de datos</a> </div> <div> <a href="#carga-de-archivos-en-python">Carga de Archivos en Python</a> </div> <div> <a href="#validaci%C3%B3n-y-verificaci%C3%B3n">Validación y verificación</a> </div> <ul> <li> <a href="#validaci%C3%B3n-de-las-llaves-primarias">Validación de las llaves primarias</a> </li> <li> <a href="#verificaci%C3%B3n-de-integridad-referencial">Verificación de integridad referencial</a> </li> <li> <a href="#manejo-de-valores-faltantes">Manejo de valores faltantes</a> </li> </ul> <div> <a href="#fusi%C3%B3n-de-tablas">Fusión de tablas</a> </div> <ul> <li> <a href="#funci%C3%B3n-de-limpieza-de-tablas">Función de limpieza de tablas</a> </li> <li> <a href="#visualizaci%C3%B3n-de-la-tabla-final">Visualización de la tabla final</a> </li> <li> <a href="#guardado-de-la-base-de-datos">Guardado de la base de datos</a> </li> </ul> <div> <a href="#conclusi%C3%B3n">Conclusión</a> </div> </nav> </d-contents> <p style="text-align: justify;"> <b>La Encuesta Nacional de Ocupación y Empleo</b><d-cite key="inegi_enoe_wp"></d-cite> (ENOE) elaborada por el <b>Instituto Nacional de Estadística y Geografía</b> (INEGI) es una de las fuentes más importantes para comprender el mercado laboral mexicano. Proporciona datos mensuales y trimestrales con alcance nacional abarcando cada una de las 32 entidades federativas y un total de 39 ciudades. Este proyecto está inspirado en el Libro <i>¿Cómo empezar a estudiar el mercado de trabajo en México? Una introducción al análisis estadístico con R aplicado a la Encuesta Nacional de Ocupación y Empleo</i> <d-cite key="escotoanaruth_book"></d-cite> y tiene como objetivo demostrar cómo trabajar con la ENOE utilizando Python, desde la preparación de los datos hasta su análisis. </p> <p style="text-align: justify;"> Este escrito es el primero de tres en los que se trabaja con la ENOE: </p> <ol> <li> <strong>Configuración de la base de datos</strong>: Desde la descarga de los datos hasta su limpieza y preparación para el análisis.</li> <li> <strong>Análisis estadístico y visualización</strong>: Realización de análisis básicos y visualizaciones utilizando la base de datos configurada.</li> <li> <strong>Análisis avanzado y predicciones</strong>: Propuesta de análisis más complejos, incluyendo modelado predictivo e interpretación de resultados.</li> </ol> <p style="text-align: justify;"> A continuación, se detallan los pasos para obtener una <b>base de datos configurada</b> y lista para su análisis, comenzando por la extracción de los datos, su transformación y limpieza. </p> <hr> <h2 id="flujo-de-trabajo">Flujo de trabajo</h2> <p>El proceso para trabajar con la ENOE sigue un flujo estructurado que garantiza la integridad y consistencia de los datos:</p> <ol> <li> <strong>Descarga de datos</strong>: Obtener la base de datos de la ENOE desde el sitio oficial del INEGI.</li> <li> <strong>Carga de archivos</strong>: Leer los datos en Python utilizando bibliotecas especializadas.</li> <li> <strong>Validación y verificación</strong>: Asegurar la integridad de los datos y la correcta relación entre las tablas.</li> <li> <strong>Fusión de tablas</strong>: Integrar las tablas para crear una base de datos multidimensional.</li> <li> <strong>Limpieza y preparación</strong>: Eliminar duplicados, manejar valores faltantes y asegurar la consistencia de los datos.</li> <li> <strong>Visualización y guardado</strong>: Explorar los datos procesados y guardar la base final para su uso posterior.</li> </ol> <hr> <h2 id="entendiendo-las-tablas-y-sus-relaciones">Entendiendo las tablas y sus relaciones</h2> <p style="text-align: justify;"> La base de datos de la ENOE está conformada por <b>cinco tablas principales</b> , que están relacionadas entre si mediante campos comunes. Estas tablas son: </p> <ol> <li> <b>Vivienda (VIV)</b>: Contiene información sobre las viviendas encuestadas.</li> <li> <b>Hogares (HOG)</b>: Contiene datos sobre los hogares dentro de las viviendas.</li> <li> <b>Sociodemográfico (SDEM)</b>: Contiene información sociodemográfica de los residentes de los hogares.</li> <li> <b>Cuestionario de Ocupación y Empleo I (COE1)</b>: Contiene datos sobre ocupación y empleo (batería 1 a 5).</li> <li> <b>Cuestionario de Ocupación y Empleo II (COE2)</b>: Contiene datos adicionales sobre ocupación y empleo (batería 6 en adelante).</li> </ol> <p style="text-align: justify;"> Las tablas se relacionan mediante llaves primarias compuestas por campos comunes, como: </p> <ul> <li> <b>CD_A</b>: Ciudad auto-representada.</li> <li> <b>ENT</b>: Entidad federativa.</li> <li> <b>CON</b>: Control.</li> <li> <b>V_SEL</b>: Vivienda seleccionada.</li> <li> <b>N_HOG</b>: Número de hogar.</li> <li> <b>H_MUD</b>: Hogar mudado.</li> <li> <b>N_REN</b>: Número de renglón (identificador único de residente).</li> </ul> <p style="text-align: justify;"> Estas relaciones permiten vincular las tablas para realizar análisis más complejos. </p> <hr> <h3 id="factor-de-expansión">Factor de expansión</h3> <p style="text-align: justify;"> La tabla <b>SDEM</b> contiene un campo llamado <b>"FAC"</b>, que es el factor de expansión. Este campo es crucial para realizar estimaciones poblacionales, ya que indica cuántas personas representa cada registro en la muestra. Para realizar análisis multidimensionales, es importante incluir este campo en la tabla final, ya que permite escalar los datos a nivel nacional.<d-cite key="comosehacelaenoe"></d-cite> </p> <h3 id="diseño-de-modelo-multidimensional">Diseño de modelo multidimensional</h3> <p style="text-align: justify;"> Crear una base de datos multidimensional a partir de la ENOE implica organizar la información de manera eficiente. Para ello, es necesario entender las tablas, sus relaciones y los conceptos clave. En este contexto, las <b>dimensiones</b> son las categorías por las cuales se pueden analizar los datos, como tiempo, ubicación, género, nivel educativo, etc. Por otro lado, los <b>hechos</b> son los datos numéricos asociados a estas categorías, como ingresos, horas trabajadas, sector de actividad económica, etc. </p> <p style="text-align: justify;"> Es crucial integrar correctamente las tablas y optimizar el modelo para consultas y análisis rígidos y eficientes </p> <h2 id="descarga-de-datos">Descarga de datos</h2> <p style="text-align: justify;"> Se ha seleccionado la encuesta del <b> cuarto trimestre del 2022</b>, disponible en formato <code>.dta</code> (utilizado por STATA). Este formato contiene un archivo de valores separado por tabuladores que puede incluir diferentes tipos de datos separados en filas y columnas. Tras descargar y descomprimir los archivos se obtienen las siguientes cinco tablas: </p> <ul> <li><code class="language-plaintext highlighter-rouge">ENOEN_COE1T422.dta</code></li> <li><code class="language-plaintext highlighter-rouge">ENOEN_COE2T422.dta</code></li> <li><code class="language-plaintext highlighter-rouge">ENOEN_HOGT422.dta</code></li> <li><code class="language-plaintext highlighter-rouge">ENOEN_VIVT422.dta</code></li> <li><code class="language-plaintext highlighter-rouge">ENOEN_SDEMT422.dta</code></li> </ul> <h2 id="carga-de-archivos-en-python">Carga de archivos en Python</h2> <p>A continuación en un Jupyter Notebook se instala e importa la biblioteca pyreadstat con la siguiente línea de código:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Instalación de la librería pyreadstat
</span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyreadstat</span>
<span class="c1"># Importación de la librería
</span><span class="kn">import</span> <span class="n">pyreadstat</span>
</code></pre></div></div> <p style="text-align: justify;"> Es importante que el archivo de Jupyter Notebook se encuentre en la misma carpeta que las tablas para evitar conflictos con las rutas de los archivos. Una vez instalada e importada la biblioteca, se procede a cargar las tablas y aplicar formatos legibles para facilitar su comprensión: </p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Carga de tablas con formatos legibles
</span><span class="n">coet1422</span><span class="p">,</span> <span class="n">meta1</span> <span class="o">=</span> <span class="n">pyreadstat</span><span class="p">.</span><span class="nf">read_dta</span><span class="p">(</span><span class="sh">'</span><span class="s">ENOEN_COE1T422.dta</span><span class="sh">'</span><span class="p">,</span> <span class="n">apply_value_formats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">coet2422</span><span class="p">,</span> <span class="n">meta2</span> <span class="o">=</span> <span class="n">pyreadstat</span><span class="p">.</span><span class="nf">read_dta</span><span class="p">(</span><span class="sh">'</span><span class="s">ENOEN_COE2T422.dta</span><span class="sh">'</span><span class="p">,</span> <span class="n">apply_value_formats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">hogt422</span><span class="p">,</span> <span class="n">meta3</span> <span class="o">=</span> <span class="n">pyreadstat</span><span class="p">.</span><span class="nf">read_dta</span><span class="p">(</span><span class="sh">'</span><span class="s">ENOEN_HOGT422.dta</span><span class="sh">'</span><span class="p">,</span> <span class="n">apply_value_formats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">vivt422</span><span class="p">,</span> <span class="n">meta4</span> <span class="o">=</span> <span class="n">pyreadstat</span><span class="p">.</span><span class="nf">read_dta</span><span class="p">(</span><span class="sh">'</span><span class="s">ENOEN_VIVT422.dta</span><span class="sh">'</span><span class="p">,</span> <span class="n">apply_value_formats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sdemt422</span><span class="p">,</span> <span class="n">meta5</span> <span class="o">=</span> <span class="n">pyreadstat</span><span class="p">.</span><span class="nf">read_dta</span><span class="p">(</span><span class="sh">'</span><span class="s">ENOEN_SDEMT422.dta</span><span class="sh">'</span><span class="p">,</span> <span class="n">apply_value_formats</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> <p style="text-align: justify;"> El parámetro <code>apply_value_formats=True</code> convierte los códigos numéricos en nombres de categorías, lo que facilita la lectura de las tablas. En este proyecto, solo se utilizarán las variables con los nombres de cada tabla, ya que las variables "meta" contienen metadatos que no son relevantes para este análisis. </p> <hr> <h2 id="validación-y-verificación">Validación y verificación</h2> <p style="text-align: justify;"> La etapa de la validación de datos es un paso que ayuda a mantener su integridad, mejorando la consistencia de los análisis posteriores y a reproducir el proceso. En esta parte se verifica que las llaves primarias sean consistentes en cada tabla. </p> <ul> <li>Primero se asignan los indicadores a las llaves primarias</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idvivienda</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">cd_a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ent</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">con</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">v_sel</span><span class="sh">'</span><span class="p">]</span>
<span class="n">idhogar</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">cd_a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ent</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">con</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">v_sel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_hog</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">h_mud</span><span class="sh">'</span><span class="p">]</span>
<span class="n">idpersona</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">cd_a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ent</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">con</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">v_sel</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_hog</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">h_mud</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_ren</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> <h3 id="validación-de-las-llaves-primarias">Validación de las llaves primarias</h3> <p>Validar la consistencia puede hacerse de la siguiente manera:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Verificar duplicados en las llaves primarias
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Duplicados en VIVIENDA:</span><span class="sh">"</span><span class="p">,</span> <span class="n">vivt422</span><span class="p">.</span><span class="nf">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">idvivienda</span><span class="p">).</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Duplicados en HOGAR:</span><span class="sh">"</span><span class="p">,</span> <span class="n">hogt422</span><span class="p">.</span><span class="nf">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">idhogar</span><span class="p">).</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Duplicados en SDEM:</span><span class="sh">"</span><span class="p">,</span> <span class="n">sdemt422</span><span class="p">.</span><span class="nf">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">idpersona</span><span class="p">).</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Duplicados en COE1:</span><span class="sh">"</span><span class="p">,</span> <span class="n">coet1422</span><span class="p">.</span><span class="nf">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">idpersona</span><span class="p">).</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Duplicados en COE2:</span><span class="sh">"</span><span class="p">,</span> <span class="n">coet2422</span><span class="p">.</span><span class="nf">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">idpersona</span><span class="p">).</span><span class="nf">sum</span><span class="p">())</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Output</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Duplicados en VIVIENDA: 0
Duplicados en HOGAR: 0
Duplicados en SDEM: 0
Duplicados en COE1: 0
Duplicados en COE2: 0
</code></pre></div></div> <p>El código busca duplicados para cada identificador asociado a una tabla y los imprime según los encuentre. En este caso no se encontró ninguno</p> <h3 id="verificación-de-integridad-referencial">Verificación de integridad referencial</h3> <p style="text-align: justify;"> Asegura de que las relaciones entre tablas sean válidas. Por ejemplo, verifica que todas las variables de <code>idhogar</code> en la tabla <code>sdem</code> existan en la tabla <code>hog</code>, y que todos los <code>idvivienda</code> en <code>hog</code> existan en <code>viv</code> </p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Verificar integridad referencial entre HOG y VIV
</span><span class="n">hog_viv_check</span> <span class="o">=</span> <span class="n">hogt422</span><span class="p">[</span><span class="o">~</span><span class="n">hogt422</span><span class="p">[</span><span class="n">idvivienda</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="n">vivt422</span><span class="p">[</span><span class="n">idvivienda</span><span class="p">].</span><span class="nf">to_dict</span><span class="p">(</span><span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">)).</span><span class="nf">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Registros en HOG sin correspondencia en VIV:</span><span class="sh">"</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">hog_viv_check</span><span class="p">))</span>

<span class="c1"># Verificar integridad referencial entre SDEM y HOG
</span><span class="n">sdem_hog_check</span> <span class="o">=</span> <span class="n">sdemt422</span><span class="p">[</span><span class="o">~</span><span class="n">sdemt422</span><span class="p">[</span><span class="n">idhogar</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="n">hogt422</span><span class="p">[</span><span class="n">idhogar</span><span class="p">].</span><span class="nf">to_dict</span><span class="p">(</span><span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">)).</span><span class="nf">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Registros en SDEM sin correspondencia en HOG:</span><span class="sh">"</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">sdem_hog_check</span><span class="p">))</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Output</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Registros en HOG sin correspondencia en VIV: 0
Registros en SDEM sin correspondencia en HOG: 13758
</code></pre></div></div> <p>Si encuentra registros sin correspondencia puede decidir si eliminarlos o investigar la causa, en este caso se omitieron</p> <h3 id="manejo-de-valores-faltantes">Manejo de valores faltantes</h3> <p>Un paso más de la verificación es el manejo de valores faltantes de las llaves primarias, por ejemplo:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Verificar valores faltantes en las llaves primarias
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Valores faltantes en VIVIENDA:</span><span class="sh">"</span><span class="p">,</span> <span class="n">vivt422</span><span class="p">[</span><span class="n">idvivienda</span><span class="p">].</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Valores faltantes en HOGAR:</span><span class="sh">"</span><span class="p">,</span> <span class="n">hogt422</span><span class="p">[</span><span class="n">idhogar</span><span class="p">].</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Valores faltantes en SDEM:</span><span class="sh">"</span><span class="p">,</span> <span class="n">sdemt422</span><span class="p">[</span><span class="n">idpersona</span><span class="p">].</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Valores faltantes en COE1:</span><span class="sh">"</span><span class="p">,</span> <span class="n">coet1422</span><span class="p">[</span><span class="n">idpersona</span><span class="p">].</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">())</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Valores faltantes en COE2:</span><span class="sh">"</span><span class="p">,</span> <span class="n">coet2422</span><span class="p">[</span><span class="n">idpersona</span><span class="p">].</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">())</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Output</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Valores faltantes en VIVIENDA: cd_a     0
ent      0
con      0
v_sel    0
dtype: int64
Valores faltantes en HOGAR: cd_a     0
ent      0
con      0
v_sel    0
n_hog    0
h_mud    0
dtype: int64
Valores faltantes en SDEM: cd_a     0
ent      0
con      0
v_sel    0
n_hog    0
h_mud    0
n_ren    0
dtype: int64
Valores faltantes en COE1: cd_a     0
ent      0
con      0
v_sel    0
n_hog    0
h_mud    0
n_ren    0
dtype: int64
Valores faltantes en COE2: cd_a     0
ent      0
con      0
v_sel    0
n_hog    0
h_mud    0
n_ren    0
dtype: int64
</code></pre></div></div> <p style="text-align: justify;"> La etapa de validación y verificación es importante para la construcción de la base de datos porque disminuye la perdidad de información e incrementa la confianza en los resultados </p> <h2 id="fusión-de-tablas">Fusión de tablas</h2> <p style="text-align: justify;"> La fusión de las tablas es un paso crucial para construir una base de datos multidimensional que permita realizar análisis complejos. Este proceso implica unir las tablas utilizando las llaves primarias compuestas por campos comunes. </p> <p style="text-align: justify;"> Realizar la fusión de las tablas es un proceso simple pero cada paso es de suma importancia para minimizar la perdida de información. </p> <p style="text-align: justify;"> El siguiente gráfico corresponde al modelo <b>entidad-relación</b> que nos proporciona el INEGI, en el se observan columnas que representan a cada tabla, a su vez, estas contienen identificadores y nombres de variables ubicados en la parte superior e inferior respectivamente, por ejemplo las tablas <b>COE2T</b> y <b>COE1T</b> tienen los mismos identificadores mencionados anteriormente. El modelo es la representación gráfica de las dimensiones de la encuesta. </p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/thisportfolio.github.io/assets/img/modelo_er_enoen_2022_4t-480.webp 480w,/thisportfolio.github.io/assets/img/modelo_er_enoen_2022_4t-800.webp 800w,/thisportfolio.github.io/assets/img/modelo_er_enoen_2022_4t-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/thisportfolio.github.io/assets/img/modelo_er_enoen_2022_4t.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="modelo_entidad_relacion" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <div class="caption">Fuente: INEGI, <i>Encuesta Nacional de Ocupación y Empleo.</i> </div> </div> </div> <p>Los siguientes pasos nos permiten unir las tablas:</p> <ul> <li>Importa la librería <code class="language-plaintext highlighter-rouge">pandas</code>. <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div> </div> </li> <li>En seguida une por medio de <code class="language-plaintext highlighter-rouge">merge</code> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c1"># Unión con inner join para asegurar correspondencia
</span><span class="n">coet422</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">coe1t422</span><span class="p">,</span> <span class="n">coe2t422</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">idpersona</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">inner</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sdemcoet422</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">sdemt422</span><span class="p">,</span> <span class="n">coet422</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">idpersona</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">inner</span><span class="sh">'</span><span class="p">)</span>
<span class="n">vivhogt422</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">vivt422</span><span class="p">,</span> <span class="n">hogt422</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">idvivienda</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">inner</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># Tabla resultante
</span><span class="n">completat422</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">sdemcoet422</span><span class="p">,</span> <span class="n">vivhogt422</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">idhogar</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">inner</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div> </div> </li> </ul> <p style="text-align: justify;"> En la primer linea de código la función <i><code>merge</code></i> une la tabla <code>coet1422</code> con <code>coet2422</code> utilizando los indicadores dentro de la variable <code>idpersona</code> como puntos de coincidencias para unir los datos y usa <code>inner</code> para unir todas las coincidencias. La tabla devuelta contiene los datos correspondientes pero también columnas "duplicadas" que son fácilmente diferenciables por los sufijos <code>_x</code> y <code>_y</code>. </p> <p style="text-align: justify;"> <br> Particularmente para este proyecto se considera una función para manejar la limpieza de las tablas eliminando aquellas columnas redundantes generadas a partir del paso anterior, sin embargo el uso de esta función es totalmente opcional </p> <h3 id="función-de-limpieza-de-tablas">Función de limpieza de tablas</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">limpiar_tabla</span><span class="p">(</span><span class="n">tabla</span><span class="p">):</span>
    <span class="c1"># Eliminar columnas duplicadas
</span>    <span class="n">columnas_unicas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tabla</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">_x</span><span class="sh">'</span><span class="p">):</span>
            <span class="n">col_original</span> <span class="o">=</span> <span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Eliminar '_x'
</span>            <span class="k">if</span> <span class="n">col_original</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">columnas_unicas</span><span class="p">:</span>
                <span class="n">columnas_unicas</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">col_original</span><span class="p">)</span>
                <span class="n">tabla</span> <span class="o">=</span> <span class="n">tabla</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">col_original</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">col</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">_y</span><span class="sh">'</span><span class="p">):</span>
            <span class="n">tabla</span> <span class="o">=</span> <span class="n">tabla</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>  <span class="c1"># Eliminar columnas con '_y'
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="n">columnas_unicas</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tabla</span>
</code></pre></div></div> <p>Y se ejecuta sobre <code class="language-plaintext highlighter-rouge">completat422</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">completat422</span> <span class="o">=</span> <span class="nf">limpiar_tabla</span><span class="p">(</span><span class="n">completat422</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">completat422</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div> <p>Finalmente mostramos un fragmento de la tabla <code class="language-plaintext highlighter-rouge">completat422</code> que contiene toda la información necesaria para crear análisis estadísticos.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Función tail() para devolver las primeras "n" filas del DataFrame
</span><span class="n">completat422</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <h3 id="visualización-de-la-tabla-final">Visualización de la tabla final</h3> <div class="l-body-outset" style="overflow-x: auto; padding: 10px; margin-bottom: 20px;"> <style scoped="">.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe{width:100%;border-collapse:collapse;margin:0 auto}.dataframe td,.dataframe th{padding:px;text-align:center;border:2px solid #030000}.dataframe tbody tr:nth-child(even){background-color:#541515}.dataframe tbody tr:hover{background-color:#541515}</style> <table border="0" class="dataframe"> <thead> <tr style="text-align: center;"> <th></th> <th>r_def</th> <th>loc</th> <th>mun</th> <th>est</th> <th>est_d_tri</th> <th>est_d_men</th> <th>ageb</th> <th>t_loc_tri</th> <th>t_loc_men</th> <th>cd_a</th> <th>...</th> <th>r_pre</th> <th>p_dia</th> <th>p_mes</th> <th>p_anio</th> <th>r_def</th> <th>d_dia</th> <th>d_mes</th> <th>d_anio</th> <th>e_obs</th> <th>inf</th> </tr> </thead> <tbody> <tr> <th>0</th> <td>Entrevista completa</td> <td>NaN</td> <td>39.0</td> <td>40.0</td> <td>188.0</td> <td>NaN</td> <td>0.0</td> <td>Localidades mayores de 100000 habitantes</td> <td>NaN</td> <td>Guadalajara</td> <td>...</td> <td>Entrevista completa</td> <td>27.0</td> <td>9.0</td> <td>22.0</td> <td>Entrevista completa</td> <td>27.0</td> <td>9.0</td> <td>22.0</td> <td>No</td> <td>1.0</td> </tr> <tr> <th>1</th> <td>Entrevista completa</td> <td>NaN</td> <td>39.0</td> <td>40.0</td> <td>188.0</td> <td>NaN</td> <td>0.0</td> <td>Localidades mayores de 100000 habitantes</td> <td>NaN</td> <td>Guadalajara</td> <td>...</td> <td>Entrevista completa</td> <td>27.0</td> <td>9.0</td> <td>22.0</td> <td>Entrevista completa</td> <td>27.0</td> <td>9.0</td> <td>22.0</td> <td>No</td> <td>1.0</td> </tr> <tr> <th>2</th> <td>Entrevista completa</td> <td>NaN</td> <td>39.0</td> <td>40.0</td> <td>188.0</td> <td>NaN</td> <td>0.0</td> <td>Localidades mayores de 100000 habitantes</td> <td>NaN</td> <td>Guadalajara</td> <td>...</td> <td>Entrevista completa</td> <td>28.0</td> <td>9.0</td> <td>22.0</td> <td>Entrevista completa</td> <td>28.0</td> <td>9.0</td> <td>22.0</td> <td>No</td> <td>2.0</td> </tr> <tr> <th>3</th> <td>Entrevista completa</td> <td>NaN</td> <td>39.0</td> <td>40.0</td> <td>188.0</td> <td>NaN</td> <td>0.0</td> <td>Localidades mayores de 100000 habitantes</td> <td>NaN</td> <td>Guadalajara</td> <td>...</td> <td>Entrevista completa</td> <td>28.0</td> <td>9.0</td> <td>22.0</td> <td>Entrevista completa</td> <td>28.0</td> <td>9.0</td> <td>22.0</td> <td>No</td> <td>2.0</td> </tr> <tr> <th>4</th> <td>Entrevista completa</td> <td>NaN</td> <td>39.0</td> <td>40.0</td> <td>188.0</td> <td>NaN</td> <td>0.0</td> <td>Localidades mayores de 100000 habitantes</td> <td>NaN</td> <td>Guadalajara</td> <td>...</td> <td>Entrevista completa</td> <td>28.0</td> <td>9.0</td> <td>22.0</td> <td>Entrevista completa</td> <td>28.0</td> <td>9.0</td> <td>22.0</td> <td>No</td> <td>2.0</td> </tr> </tbody> </table> <p>5 rows × 370 columns</p> </div> <h3 id="guardado-de-la-base-de-datos">Guardado de la base de datos</h3> <p style="text-align: justify;"> Una vez finalizada la fusión y limpieza de las tablas, es importante guardar la base de datos para su uso posterior. En este caso, se guarda en formato <code>.csv</code>, un formato simple y ampliamente compatible: </p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">completat422</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">completat422.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">false</span><span class="p">)</span>
</code></pre></div></div> <hr> <h2 id="conclusión">Conclusión</h2> <p style="text-align: justify;"> El método presentado en este artículo proporciona una herramienta para el estudio del mercado laboral mexicano utilizando la Encuesta Nacional de Ocupación y Empleo (ENOE). A través de Python, es posible construir una base de datos multidimensional que permita realizar análisis estadísticos y visualizaciones avanzadas. Este enfoque no solo facilita el manejo de grandes volúmenes de datos, sino que también promueve el uso de herramientas de programación en el análisis de ciencias sociales. </p> <p style="text-align: justify;"> Se espera que este artículo sea de utilidad tanto para quienes se acercan por primera vez al análisis de datos con Python como para aquellos que buscan profundizar en el estudio del mercado laboral mexicano. Para ampliar este análisis, se pueden aplicar métodos estadísticos avanzados y visualizaciones utilizando bibliotecas como <code>matplotlib</code> o <code>seaborn</code>. </p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/thisportfolio.github.io/assets/bibliography/my_bib.bib"></d-bibliography> <div id="giscus_thread" style="max-width: 950px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"AdrianV443/thisportfolio.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"es",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Adrian Vázquez E.. </div> </footer> <script src="/thisportfolio.github.io/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/thisportfolio.github.io/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <style>.toc-wrapper{<!--padding:1rem;-->border-radius:8px;<!--box-shadow:0 2px 4px rgba(0,0,0,0.1);-->}.floating-toc{position:sticky;top:30px;max-height:calc(100vh - 20px);overflow-y:auto}.toc-wrapper a{color:#df0000;text-decoration:none;display:block;margin:.5rem 0}.toc-wrapper a:hover{color:#0056a3;text-decoration:underline}.toc-wrapper ul{list-style-type:disc;margin-left:1.5rem}</style> </body> </html>